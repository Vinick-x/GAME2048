<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport"
    content="width=device-width, height=device-height, initial-scale=1.0 minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="stylesheet" href="./css/2048.css">
  <script src="./jquery.min.js"></script>
  <script src="./js/utils.js"></script>
  <script src="./js/animations.js"></script>
  <script src="./js/main.js"></script>
  <title>Game2048</title>
</head>

<body>
  <div class="background">
    <audio src="./audio/start.mp3" id="start"></audio>
    <audio src="./audio/stone.wav" id="stone"></audio>
    <audio src="./audio/conflict.mp3" id="ice"></audio>
    <audio src="./audio/nomove.mp3" id="nomove"></audio>
    <audio src="./audio/gameover.mp3" id="gameover"></audio>
    <!-- <audio id="bgm" autoplay="autoplay" preload="auto" loop>
      <source src="./audio/bgm.mp3" type="audio/mp3" />
    </audio> -->
    <header>
      <h1>2048</h1>
      <a href="javascript: newGame(); " id="newGame">New Game</a>

      <p>score: <span id="score">0</span></p>
    </header>

    <!-- 游戏网格 -->

    <div class="grid-container">
      <div class="grid-cell" id="grid-cell-0-0"></div>
      <div class="grid-cell" id="grid-cell-0-1"></div>
      <div class="grid-cell" id="grid-cell-0-2"></div>
      <div class="grid-cell" id="grid-cell-0-3"></div>

      <div class="grid-cell" id="grid-cell-1-0"></div>
      <div class="grid-cell" id="grid-cell-1-1"></div>
      <div class="grid-cell" id="grid-cell-1-2"></div>
      <div class="grid-cell" id="grid-cell-1-3"></div>

      <div class="grid-cell" id="grid-cell-2-0"></div>
      <div class="grid-cell" id="grid-cell-2-1"></div>
      <div class="grid-cell" id="grid-cell-2-2"></div>
      <div class="grid-cell" id="grid-cell-2-3"></div>

      <div class="grid-cell" id="grid-cell-3-0"></div>
      <div class="grid-cell" id="grid-cell-3-1"></div>
      <div class="grid-cell" id="grid-cell-3-2"></div>
      <div class="grid-cell" id="grid-cell-3-3"></div>
    </div>
    <div id="audioBox"></div>
    <div class="modal">
      <div class="dialog">
        <div class="dialog-body">
          <span>＿|￣|● Game over！</span>
        </div>
        <div class="dialog-footer">
          <a href="javascript:;" id="leave" style="background-color:  rgb(243, 169, 8)">lz不玩了</a>
          <a href="javascript:;" id="again" style="background-color:rgb(248, 27, 27)">死磕到底</a>
        </div>
      </div>
    </div>
    <footer>
      <h4 id="description">移动端请滑动屏幕进行游戏</h4>
      <h4 id="description">电脑端请使用键盘“ ↑、 ↓、 ←、 →” 进行游戏</h4>
      <p>Designed By vinick</p>
    </footer>
  </div>
  <script type="text/javascript"> 
    window.onload = function(){
      function playMusic() {
        var arr = ["./audio/bgm11.mp3", "./audio/bgm.mp3","./audio/bgm2.mp3", "./audio/bgm3.mp3"]               //把需要播放的歌曲从后往前排，这里已添加两首音乐，可继续添加多个音乐 
        var myAudio = new Audio() 
        myAudio.preload = true 
        myAudio.controls = true 
        myAudio.src = arr.pop()         //每次读数组最后一个元素 
        myAudio.autoplay = true
        myAudio.addEventListener('ended', playEndedHandler, false) 
        document.addEventListener('keydown', playMusic, false) 
        document.addEventListener("touchstart", playMusic, false)
        function playMusic() {
          myAudio.play() 
        }
        document.getElementById("audioBox").appendChild(myAudio) 
        myAudio.loop = false //禁止循环，否则无法触发ended事件 
        function playEndedHandler() { 
          myAudio.src = arr.pop() 
          myAudio.play() 
          console.log(arr.length) 
          if (!arr.length) {
            arr = ["./audio/bgm11.mp3", "./audio/bgm.mp3","./audio/bgm2.mp3", "./audio/bgm3.mp3"]  
          }
          // !arr.length && myAudio.removeEventListener('ended',playEndedHandler,false)//只有一个元素时解除绑定 
        } 
      }
      
      playMusic()
    }

  </script> 
</body>

</html>